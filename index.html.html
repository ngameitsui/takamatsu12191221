<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜æ¾æ—…éŠå³æ™‚åŒæ­¥æ‰‹å†Š</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, push, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBA6MsDbbg_mqeLzliJfN1DyrFmUd_CrKo",
            authDomain: "takamatsu12191221.firebaseapp.com",
            databaseURL: "https://takamatsu12191221-default-rtdb.firebaseio.com",
            projectId: "takamatsu12191221",
            storageBucket: "takamatsu12191221.firebasestorage.app",
            messagingSenderId: "701975778652",
            appId: "1:701975778652:web:030547b85044b2cad75d99",
            measurementId: "G-ZKWE4934GZ"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const analytics = getAnalytics(app);
        const tripRef = ref(db, 'takamatsu_trip');

        const weatherInfo = {
            1: "â˜€ï¸ 19/12ï¼š9Â°C - 13Â°C / é™é›¨ 0%",
            2: "â˜ï¸ 20/12ï¼š8Â°C - 12Â°C / é™é›¨ 20%",
            3: "â˜€ï¸ 21/12ï¼š7Â°C - 11Â°C / é™é›¨ 10%"
        };

        onValue(tripRef, (snapshot) => {
            const data = snapshot.val() || { names: {a: "æˆå“¡ A", b: "æˆå“¡ B"}, itinerary: {}, expenses: {a: 0, b: 0} };
            renderUI(data);
        });

        function renderUI(data) {
            document.getElementById('nameA').value = data.names?.a || "æˆå“¡ A";
            document.getElementById('nameB').value = data.names?.b || "æˆå“¡ B";
            document.querySelectorAll('.display-name-a').forEach(el => el.innerText = data.names?.a || "æˆå“¡ A");
            document.querySelectorAll('.display-name-b').forEach(el => el.innerText = data.names?.b || "æˆå“¡ B");
            
            document.getElementById('totalA').innerText = `Â¥${(data.expenses?.a || 0).toLocaleString()}`;
            document.getElementById('totalB').innerText = `Â¥${(data.expenses?.b || 0).toLocaleString()}`;

            for (let day = 1; day <= 3; day++) {
                const listEl = document.getElementById(`list-day${day}`);
                const dayData = data.itinerary ? data.itinerary[`day${day}`] : null;
                listEl.innerHTML = "";
                if (dayData) {
                    const items = Object.entries(dayData).map(([id, val]) => ({ id, ...val }));
                    items.sort((a, b) => a.time.localeCompare(b.time));
                    items.forEach(item => {
                        listEl.innerHTML += `
                            <div class="flex items-center justify-between bg-white p-3 rounded-lg border-l-4 border-[#B4A582] mb-2 shadow-sm">
                                <div><span class="font-bold mr-3 text-[#B4A582]">${item.time}</span><span class="text-gray-700">${item.loc}</span></div>
                                <button onclick="window.deleteItem(${day}, '${item.id}')" class="text-gray-300 hover:text-red-400 px-2">âœ•</button>
                            </div>`;
                    });
                }
            }
        }

        window.updateNames = () => {
            set(ref(db, 'takamatsu_trip/names'), {
                a: document.getElementById('nameA').value || "æˆå“¡ A",
                b: document.getElementById('nameB').value || "æˆå“¡ B"
            });
        };

        window.addItem = (day) => {
            const time = document.getElementById(`time-day${day}`).value;
            const loc = document.getElementById(`loc-day${day}`).value;
            if(!time || !loc) return;
            push(ref(db, `takamatsu_trip/itinerary/day${day}`), { time, loc });
            document.getElementById(`loc-day${day}`).value = "";
        };

        window.deleteItem = (day, id) => {
            remove(ref(db, `takamatsu_trip/itinerary/day${day}/${id}`));
        };

        window.addExpense = () => {
            const payer = document.getElementById('payerSelect').value;
            const amount = parseFloat(document.getElementById('expAmount').value);
            if(isNaN(amount)) return;
            
            const path = `takamatsu_trip/expenses/${payer.toLowerCase()}`;
            onValue(ref(db, path), (snapshot) => {
                const current = snapshot.val() || 0;
                set(ref(db, path), current + amount);
            }, { onlyOnce: true });
            
            document.getElementById('expAmount').value = "";
        };
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');
        
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            background-color: #FFFFFF; /* æ”¹ç‚ºç´”ç™½èƒŒæ™¯ */
            color: #B4A582; /* æ”¹ç‚ºå¤§åœ°é‡‘æ–‡å­— */
            min-height: 100vh;
        }

        .glass-card { 
            background: rgba(180, 165, 130, 0.08); /* ä½¿ç”¨ä¸»é¡Œè‰²çš„æ·ºè‰²é€æ˜ç‰ˆ */
            border: 1px solid rgba(180, 165, 130, 0.2);
            border-radius: 1.5rem; 
            padding: 1.5rem; 
            margin-bottom: 1.5rem;
        }

        /* æ ¸å¿ƒä¿®æ”¹ï¼šå¤§å¹…å¢åŠ å·¦å´å…§é‚Šè·ï¼Œç¢ºä¿æ–‡å­—ä¸æœƒè²¼é‚Š */
        input, select {
            background-color: #fcfbf9 !important;
            border: 1px solid rgba(180, 165, 130, 0.3) !important;
            color: #6d644d !important; /* è¼¸å…¥æ¡†æ–‡å­—ç¨å¾®æ·±ä¸€é»æ–¹ä¾¿é–±è®€ */
            border-radius: 0.8rem !important; 
            padding-top: 0.8rem !important;
            padding-bottom: 0.8rem !important;
            padding-left: 2rem !important; /* æ˜é¡¯çš„é–“è·ï¼Œç´„ç­‰æ–¼ä¸€å€‹å¤šä¸­æ–‡å­— */
            padding-right: 1rem !important;
            outline: none; 
            width: 100%;
            -webkit-appearance: none;
        }

        input::placeholder {
            color: #B4A582;
            opacity: 0.5;
        }

        .btn-add { 
            background-color: #B4A582; 
            color: #FFFFFF; 
            font-weight: bold; 
            border-radius: 0.8rem; 
            padding: 0.8rem 1rem; 
            width: 100%; 
            transition: all 0.2s;
        }

        .btn-add:active {
            transform: scale(0.98);
            opacity: 0.9;
        }

        .day-header { 
            font-size: 1.4rem; 
            font-weight: bold; 
            border-bottom: 2px solid #B4A582; 
            margin-bottom: 1rem; 
            padding-bottom: 0.5rem;
            color: #B4A582;
        }

        .weather-text {
            color: #8c7e5e;
            font-weight: 500;
        }
    </style>
</head>
<body class="pb-10">

    <header class="p-8 text-center">
        <h1 class="text-3xl font-bold tracking-wider">é«˜æ¾ 19/12â€§20/12â€§21/12</h1>
        <p class="mt-2 opacity-70 text-sm">âœ¨ å³æ™‚é›²ç«¯åŒæ­¥æ—…è¡Œå°å¹«æ‰‹</p>
    </header>

    <div class="max-w-md mx-auto px-5">

        <section class="glass-card">
            <h2 class="font-bold mb-4">ğŸ‘¤ æˆå“¡è¨­å®š</h2>
            <div class="grid grid-cols-2 gap-4">
                <input type="text" id="nameA" placeholder="æˆå“¡ A å§“å" onchange="updateNames()">
                <input type="text" id="nameB" placeholder="æˆå“¡ B å§“å" onchange="updateNames()">
            </div>
        </section>

        <section class="glass-card">
            <div class="day-header">ğŸ—“ï¸ Day 1 (19/12)</div>
            <div class="bg-white/50 p-3 rounded-lg text-sm mb-4 weather-text">â˜€ï¸ 19/12ï¼š9Â°C - 13Â°C / é™é›¨ 0%</div>
            <div id="list-day1"></div>
            <div class="grid grid-cols-3 gap-2 mt-4">
                <input type="time" id="time-day1" style="width: auto;">
                <input type="text" id="loc-day1" placeholder="è¼¸å…¥åœ°é»" class="col-span-2">
                <button onclick="addItem(1)" class="btn-add col-span-3">ï¼‹ æ–°å¢è¡Œç¨‹</button>
            </div>
        </section>

        <section class="glass-card">
            <div class="day-header">ğŸ—“ï¸ Day 2 (20/12)</div>
            <div class="bg-white/50 p-3 rounded-lg text-sm mb-4 weather-text">â˜ï¸ 20/12ï¼š8Â°C - 12Â°C / é™é›¨ 20%</div>
            <div id="list-day2"></div>
            <div class="grid grid-cols-3 gap-2 mt-4">
                <input type="time" id="time-day2" style="width: auto;">
                <input type="text" id="loc-day2" placeholder="è¼¸å…¥åœ°é»" class="col-span-2">
                <button onclick="addItem(2)" class="btn-add col-span-3">ï¼‹ æ–°å¢è¡Œç¨‹</button>
            </div>
        </section>

        <section class="glass-card">
            <div class="day-header">ğŸ—“ï¸ Day 3 (21/12)</div>
            <div class="bg-white/50 p-3 rounded-lg text-sm mb-4 weather-text">â˜€ï¸ 21/12ï¼š7Â°C - 11Â°C / é™é›¨ 10%</div>
            <div id="list-day3"></div>
            <div class="grid grid-cols-3 gap-2 mt-4">
                <input type="time" id="time-day3" style="width: auto;">
                <input type="text" id="loc-day3" placeholder="è¼¸å…¥åœ°é»" class="col-span-2">
                <button onclick="addItem(3)" class="btn-add col-span-3">ï¼‹ æ–°å¢è¡Œç¨‹</button>
            </div>
        </section>

        <section class="glass-card">
            <h2 class="font-bold mb-4">ğŸ’° æ—…éŠåˆ†å¸³ (JPY)</h2>
            <div class="grid grid-cols-2 gap-4 mb-6">
                <div class="text-center p-3 bg-white rounded-2xl border border-[#B4A582]/30 shadow-sm">
                    <p class="text-xs opacity-70 mb-1">å·²æ”¯ä»˜ï¼š<span class="display-name-a">A</span></p>
                    <p id="totalA" class="text-2xl font-bold">Â¥0</p>
                </div>
                <div class="text-center p-3 bg-white rounded-2xl border border-[#B4A582]/30 shadow-sm">
                    <p class="text-xs opacity-70 mb-1">å·²æ”¯ä»˜ï¼š<span class="display-name-b">B</span></p>
                    <p id="totalB" class="text-2xl font-bold">Â¥0</p>
                </div>
            </div>
            <div class="space-y-3">
                <select id="payerSelect">
                    <option value="A">ç”± <span class="display-name-a">æˆå“¡ A</span> ä»˜æ¬¾</option>
                    <option value="B">ç”± <span class="display-name-b">æˆå“¡ B</span> ä»˜æ¬¾</option>
                </select>
                <input type="number" id="expAmount" placeholder="è¼¸å…¥æ—¥åœ“é‡‘é¡">
                <button onclick="addExpense()" class="btn-add mt-2">è¨˜éŒ„æ”¯å‡º</button>
            </div>
        </section>

    </div>
</body>
</html>